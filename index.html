<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Бронирование переговорных</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
  .card { background: #2a2a2a; border-radius: 8px; padding: 20px; max-width: 400px; margin: auto; }
  label { display: block; margin-top: 10px; font-size: 14px; color: #ccc; }
  input, button { width: 100%; padding: 8px; border-radius: 4px; border: none; font-size: 14px; }
  input[type="time"] { background: #333; color: #fff; }
  button { background: #444; color: #fff; cursor: pointer; }
  button:hover { background: #666; }
  .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
  .modal-content { background: #2a2a2a; padding: 20px; border-radius: 8px; width: 300px; }
  .dur-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .dur-grid button { background: #555; }
  .dur-grid button:hover { background: #777; }
</style>
</head>
<body>

<div class="card">
  <h2>Бронирование переговорной</h2>

  <label>Начало</label>
  <input id="f_start" type="time" value="10:00">

  <label>Длительность</label>
  <button id="durBtn" type="button"><span id="durLabel">60 мин</span></button>
  <input id="f_dur" type="hidden" value="60">

  <label>Окончание</label>
  <input id="f_end" type="time" value="11:00">

  <button style="margin-top:15px;">Создать бронь</button>
</div>

<!-- Модальное окно выбора длительности -->
<div id="durModal" class="modal">
  <div class="modal-content">
    <h3>Выберите длительность</h3>
    <div class="dur-grid">
      <button data-min="30">30 мин</button>
      <button data-min="60">1 час</button>
      <button data-min="90">1,5 часа</button>
      <button data-min="120">2 часа</button>
      <button data-min="150">2,5 часа</button>
      <button data-min="180">3 часа</button>
    </div>
    <button id="durClose" style="margin-top:10px;background:#444;">Закрыть</button>
  </div>
</div>

<script>
const $f = {
  start: document.getElementById('f_start'),
  end: document.getElementById('f_end'),
  dur: document.getElementById('f_dur')
};
const $durBtn   = document.getElementById('durBtn');
const $durLabel = document.getElementById('durLabel');
const $durModal = document.getElementById('durModal');
const $durClose = document.getElementById('durClose');

function hm2m(hm) {
  const [h, m] = hm.split(':').map(Number);
  return h * 60 + m;
}
function m2hm(m) {
  const h = Math.floor(m / 60);
  const mm = String(m % 60).padStart(2, '0');
  return `${String(h).padStart(2, '0')}:${mm}`;
}
function workStartMin(){ return 9 * 60; } // 09:00
function workEndMin(){   return 20 * 60; } // 20:00

function updateEndFromDur(){
  const startMin = hm2m($f.start.value);
  const durMin   = parseInt($f.dur.value || '60', 10);
  let endMin = startMin + durMin;
  endMin = Math.min(endMin, workEndMin());
  if (endMin - startMin < durMin){
    const newStart = Math.max(workStartMin(), endMin - durMin);
    $f.start.value = m2hm(newStart);
  }
  $f.end.value = m2hm(endMin);
}

function openDur(){ $durModal.style.display = 'flex'; }
function closeDur(){ $durModal.style.display = 'none'; }

$durModal.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-min]');
  if(!btn) return;
  const m = parseInt(btn.dataset.min, 10);
  $f.dur.value = String(m);
  $durLabel.textContent = btn.textContent.trim();
  updateEndFromDur();
  closeDur();
});
$durClose.addEventListener('click', closeDur);
$durBtn.addEventListener('click', openDur);
$f.start.addEventListener('change', updateEndFromDur);
$f.end.addEventListener('change', ()=>{
  const dur = hm2m($f.end.value) - hm2m($f.start.value);
  if (dur > 0){
    $f.dur.value = String(dur);
    const rounded = Math.round(dur/30)*30;
    const text = rounded===30 ? '30 мин'
               : rounded===60 ? '1 час'
               : rounded===90 ? '1,5 часа'
               : `${Math.round(rounded/60*10)/10} ч`;
    $durLabel.textContent = text;
  }
});
if (!$f.dur.value) $f.dur.value = '60';
$durLabel.textContent = '60 мин';
updateEndFromDur();
</script>

</body>
</html>
